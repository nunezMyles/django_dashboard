{% extends 'layouts/base.html' %}

{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <div class="container-fluid pb-4">

      <div class="row mt-4">
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-7">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Area</p>
                    <h5 class="font-weight-bolder">Sengkang</h5>
                    <span class="text-sm font-weight-bolder">Fernvale Link</span>
                    <!--span class="text-sm">more</span-->
                  </div>
                </div>
                <div class="col-5 text-end my-auto">
                  <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                    <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-7">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Block</p>
                    <h5 class="font-weight-bolder">413B</h5>
                    <a href="" class="text-secondary text-xs font-weight-bolder" data-toggle="tooltip" data-original-title="Edit block">
                      change
                    </a>
                  </div>
                </div>
                <div class="col-5 text-end my-auto">
                  <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                    <i class="ni ni-building text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-7">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Unit no.</p>
                    <h5 class="font-weight-bolder">#14-101</h5>
                    <a href="" class="text-secondary text-xs font-weight-bolder" data-toggle="tooltip" data-original-title="Edit unit">
                      change
                    </a>
                  </div>
                </div>
                <div class="col-5 text-end my-auto">
                  <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                    <i class="ni ni-shop text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-7">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-capitalize font-weight-bold">Type</p>
                    <h5 class="font-weight-bolder">4-room</h5>
                    <span class="text-sm font-weight-bolder">-</span>
                  </div>
                </div>
                <div class="col-5 text-end my-auto">
                  <div class="icon icon-shape bg-gradient-info shadow text-center border-radius-md">
                    <i class="ni ni-collection text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">

        <div class="col-lg-5 d-flex">
          <div class="card mb-4">
            <!--div class="card-header pb-0">
              <h6>Sensor Layout</h6>
            </div-->

            <!--div id="interactive-floor" class="card-body px-0 pt-0 pb-2"-->
            <div class="card-body px-0 pt-3 pb-0 ">
              <div id="floorplan-img-container">
                <a id="pulse1" class="pulse pulse-online" onclick="sensor_onClick(1)">
                  <i class="font-weight-bold">1</i>
                </a>
                <a id="pulse2" class="pulse pulse-offline" onclick="sensor_onClick(2)">
                  <i class="font-weight-bold">2</i>
                </a>
                <a id="pulse3" class="pulse pulse-online" onclick="sensor_onClick(3)">
                  <i class="font-weight-bold">3</i>
                </a>
                <a id="pulse4" class="pulse pulse-online" onclick="sensor_onClick(4)">
                  <i class="font-weight-bold">4</i>
                </a>
                <a id="pulse5" class="pulse pulse-offline" onclick="sensor_onClick(5)">
                  <i class="font-weight-bold">5</i>
                </a>
                <img src="/static/assets/img/floor-plans/4-room_5.png" alt="img-blur-shadow" class="img-fluid" />
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-7">
          <div class="card mb-4">
            <div class="card-header pb-0">
              <h6>Module Stands / Raspberry Pi</h6>
            </div>
            <div class="card-body px-0 pt-0 pb-2">
              <div class="table-responsive p-0">
                <table class="table align-items-center mb-0">
                  <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"></th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Id</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Room</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th>
                      <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Ip address</th>
                      <th class="text-secondary opacity-7"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1 justify-content-center">
                          <!--div>
                            <img src="/static/assets/img/team-2.jpg" class="avatar avatar-sm me-3">
                          </div-->
                          <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 me-0 font-weight-bold">1</h6>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">RB1</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Bedroom 1</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-success">Online</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="text-secondary text-xs font-weight-bold">192.168.1.101</span>
                      </td>
                      <td class="align-middle">
                        <a href="javascript:;" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit user">
                          Edit
                        </a>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1 justify-content-center">
                          <div class="d-flex flex-column">
                            <h6 class="mb-0 me-0 font-weight-bold">2</h6>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">RB2</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Bedroom 2</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-secondary">Offline</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="text-secondary text-xs font-weight-bold">192.168.1.102</span>
                      </td>
                      <td class="align-middle">
                        <a href="#!" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit user">
                          Edit
                        </a>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1 justify-content-center">
                          <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 me-0 font-weight-bold">3</h6>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">RB3</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Bedroom 3</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-success">Online</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="text-secondary text-xs font-weight-bold">192.168.1.103</span>
                      </td>
                      <td class="align-middle">
                        <a href="#!" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit user">
                          Edit
                        </a>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1 justify-content-center">
                          <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 me-0 font-weight-bold">4</h6>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">RB4</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Living room</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-success">Online</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="text-secondary text-xs font-weight-bold">192.168.1.104</span>
                      </td>
                      <td class="align-middle">
                        <a href="#!" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit user">
                          Edit
                        </a>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="d-flex px-2 py-1 justify-content-center">
                          <div class="d-flex flex-column justify-content-center">
                            <h6 class="mb-0 me-0 font-weight-bold">5</h6>
                          </div>
                        </div>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">RB5</p>
                      </td>
                      <td>
                        <p class="text-xs font-weight-bold mb-0">Kitchen</p>
                      </td>
                      <td class="align-middle text-center text-sm">
                        <span class="badge badge-sm bg-gradient-secondary">Offline</span>
                      </td>
                      <td class="align-middle text-center">
                        <span class="text-secondary text-xs font-weight-bold">192.168.1.105</span>
                      </td>
                      <td class="align-middle">
                        <a href="#!" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit user">
                          Edit
                        </a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-lg-13">
          <div class="card">
            <div class="card-header pb-0">
              <div class="d-flex">
                <div class="me-auto">
                  <h6>Sensor Reading by Room</h6>
                </div>
                
                <div class="row align-items-center">
                  <div class="col-lg-2">
                    <span class="text-xs font-weight-bolder">FROM</span>
                  </div>
                  <div class="col-lg-5">
                    <input id="datepicker-start" class="form-control cursor-pointer" data-toggle="tooltip" type="date" />
                  </div>
                  <div class="col-lg-5">
                    <input id="timepicker-start" class="form-control cursor-pointer" type="time" />
                  </div>
                </div>

                <div class="row align-items-center ms-4">
                  <div class="col-lg-2">
                    <span id="label-test" class="text-xs font-weight-bolder">TO</span>
                  </div>
                  <div class="col-lg-5">
                    <input id="datepicker-end" class="form-control cursor-pointer" type="date" />
                  </div>
                  <div class="col-lg-5">
                    <input id="timepicker-end" class="form-control cursor-pointer" type="time" />
                  </div>
                </div>

                <div class="row align-items-center ms-4 me-1">
                  <i class="fa-solid fa-arrows-rotate cursor-pointer" onclick="chartRefresh()"></i>
                </div>

              </div>
            </div>
            <div class="card-body p-3">
              <div class="chart">
                <canvas id="chart-line" class="chart-canvas" height="300px"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% include "includes/footer.html" %}

    </div>
    

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="/static/assets/js/plugins/chartjs.min.js"></script>
  <script src="/static/assets/js/plugins/Chart.extension.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactiveimagejs@2.7.1/dist/interactive-image.min.js"></script>

  <!--  update line chart w/ new time script   -->
  <script>
    function chartRefresh() {

      var startDate = $("#datepicker-start").val();   // returns 2022-12-31
      var startTime = $("#timepicker-start").val();   // returns 16:43
      var endDate = $("#datepicker-end").val();
      var endTime = $("#timepicker-end").val();
      //document.getElementById("label-test").innerHTML = "New text!";

      if (startDate == "") {
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0');
        var yyyy = today.getFullYear();
        today = yyyy + '-' + mm + '-' + dd;

        startDate = today;        
        document.getElementById("datepicker-start").value = startDate;
      }
      
      if (startTime == "") {
        startTime = "00:00"   // use 12am for startTime
        document.getElementById("timepicker-start").value = startTime;
      }

      if (endDate == "") {
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0');
        var yyyy = today.getFullYear();
        today = yyyy + '-' + mm + '-' + dd;

        endDate = today;
        document.getElementById("datepicker-end").value = endDate;
      }
      
      if (endTime == "") {
        function getTime(d){
          function pad(n){return n<10 ? '0'+n : n}
          return [
            pad(d.getUTCHours() + 8),':',
            pad(d.getUTCMinutes()),
          ].join("");
        }

        var rawDate = new Date();
        var formattedTime = getTime(rawDate);

        endTime = formattedTime;
        document.getElementById("timepicker-end").value = endTime;
      }
      
      $.ajax({
        url: "/line-graph/" + String(global_selected_sensor),
        success: function(response) {
          global_lineChart.data.datasets[0].data = response.data;
          global_lineChart.data.labels = response.labels;
          global_lineChart.update();
        }
      });
    }

  </script>

  <!--  update line chart w/ new sensor & new time script   -->
  <script>
    var global_selected_sensor = 1;
    
    function sensor_onClick(selected_sensor) {
      global_selected_sensor = selected_sensor;
      chartRefresh();
    }
  </script>

  <!--   init line chart script   -->
  <script>
    var global_lineChart;
    var ctx = document.getElementById("chart-line").getContext("2d");

    var gradientStroke1 = ctx.createLinearGradient(0, 230, 0, 50);
    gradientStroke1.addColorStop(1, 'rgba(33,148,254,0.2)');
    gradientStroke1.addColorStop(0.2, 'rgba(72,72,176,0.0)');
    gradientStroke1.addColorStop(0, 'rgba(203,12,159,0)'); //purple colors

    var gradientStroke2 = ctx.createLinearGradient(0, 230, 0, 50);
    gradientStroke2.addColorStop(1, 'rgba(20,23,39,0.2)');
    gradientStroke2.addColorStop(0.2, 'rgba(72,72,176,0.0)');
    gradientStroke2.addColorStop(0, 'rgba(20,23,39,0)'); //purple colors

    $(function() {
      $.ajax({
        url: "/line-graph/1",
        success: function(response) {
          global_lineChart = new Chart(ctx, config = {
            type: "line",
            data: {
              datasets: [{
                  data: response.data,
                  backgroundColor: gradientStroke1,
                  label: "Smoke value",
                  tension: 0.4,
                  borderWidth: 0,
                  pointRadius: 0,
                  borderColor: "#2194fe",
                  borderWidth: 3,
                  maxBarThickness: 6,
                },
                /*{
                  label: "Websites",
                  tension: 0.4,
                  borderWidth: 0,
                  pointRadius: 0,
                  borderColor: "#3A416F",
                  borderWidth: 3,
                  backgroundColor: gradientStroke2,
                  data: [30, 90, 40, 140, 290, 290, 340, 230, 400],
                  maxBarThickness: 6

                },*/
              ],
              labels: response.labels,
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              legend: {
                display: false,
              },
              tooltips: {
                enabled: true,
                mode: "index",
                intersect: false,
              },
              scales: {
                yAxes: [{
                  gridLines: {
                    borderDash: [2],
                    borderDashOffset: [2],
                    color: '#dee2e6',
                    zeroLineColor: '#dee2e6',
                    zeroLineWidth: 1,
                    zeroLineBorderDash: [2],
                    drawBorder: false,
                  },
                  ticks: {
                    suggestedMin: 0,
                    suggestedMax: 100,
                    beginAtZero: true,
                    padding: 10,
                    fontSize: 11,
                    fontColor: '#adb5bd',
                    lineHeight: 3,
                    fontStyle: 'normal',
                    fontFamily: "Open Sans",
                  },
                }, ],
                xAxes: [{
                  gridLines: {
                    zeroLineColor: 'rgba(0,0,0,0)',
                    display: false,
                  },
                  ticks: {
                    padding: 10,
                    fontSize: 11,
                    fontColor: '#adb5bd',
                    lineHeight: 3,
                    fontStyle: 'normal',
                    fontFamily: "Open Sans",
                  },
                }, ],
              },
            },
          });
        }
      });
    });
  </script>

  <!--script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script-->

{% endblock javascripts %}
